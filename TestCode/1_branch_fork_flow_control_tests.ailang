// 1_branch_fork_flow_control_tests.ailang
// COMPREHENSIVE BRANCH/FORK FLOW CONTROL TEST SUITE
// Tests all edge cases and patterns for Branch and Fork constructs

PrintMessage("==============================================")
PrintMessage("BRANCH & FORK FLOW CONTROL TEST SUITE")
PrintMessage("==============================================")
PrintMessage("")

// Test tracking
total_tests = 0
passed_tests = 0
failed_tests = 0

SubRoutine.TestResult {
    total_tests = Add(total_tests, 1)
    PrintMessage("TEST: ")
    PrintMessage(test_name)
    PrintMessage(" | Expected: ")
    PrintNumber(expected)
    PrintMessage(" | Actual: ")
    PrintNumber(actual)
    
    IfCondition EqualTo(expected, actual) ThenBlock: {
        PrintMessage(" | PASS")
        passed_tests = Add(passed_tests, 1)
    } ElseBlock: {
        PrintMessage(" | FAIL")
        failed_tests = Add(failed_tests, 1)
    }
}

// ==============================================
// SECTION 1: BASIC FORK TESTS
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("SECTION 1: BASIC FORK TESTS")
PrintMessage("==============================================")

// Test 1.1: Simple Fork True Path
test_name = "Fork true path"
result1 = 0
Fork True TrueBlock: {
    result1 = 100
} FalseBlock: {
    result1 = 999
}
expected = 100
actual = result1
RunTask(TestResult)

// Test 1.2: Simple Fork False Path
test_name = "Fork false path"
result2 = 0
Fork False TrueBlock: {
    result2 = 999
} FalseBlock: {
    result2 = 200
}
expected = 200
actual = result2
RunTask(TestResult)

// Test 1.3: Fork with expression condition
test_name = "Fork with GreaterThan"
a = 10
b = 5
result3 = 0
Fork GreaterThan(a, b) TrueBlock: {
    result3 = 1
} FalseBlock: {
    result3 = 0
}
expected = 1
actual = result3
RunTask(TestResult)

// Test 1.4: Fork with LessThan
test_name = "Fork with LessThan"
x = 3
y = 8
result4 = 0
Fork LessThan(x, y) TrueBlock: {
    result4 = 42
} FalseBlock: {
    result4 = 0
}
expected = 42
actual = result4
RunTask(TestResult)

// Test 1.5: Fork with EqualTo
test_name = "Fork with EqualTo"
val1 = 100
val2 = 100
result5 = 0
Fork EqualTo(val1, val2) TrueBlock: {
    result5 = 777
} FalseBlock: {
    result5 = 0
}
expected = 777
actual = result5
RunTask(TestResult)

// Test 1.6: Fork with complex expression
test_name = "Fork complex expr"
p = 5
q = 3
result6 = 0
Fork GreaterThan(Add(p, q), Multiply(p, 1)) TrueBlock: {
    result6 = 1  // 8 > 5, true
} FalseBlock: {
    result6 = 0
}
expected = 1
actual = result6
RunTask(TestResult)

// Test 1.7: Fork with And condition
test_name = "Fork with And"
flag1 = True
flag2 = True
result7 = 0
Fork And(flag1, flag2) TrueBlock: {
    result7 = 88
} FalseBlock: {
    result7 = 0
}
expected = 88
actual = result7
RunTask(TestResult)

// Test 1.8: Fork with Or condition
test_name = "Fork with Or"
cond1 = False
cond2 = True
result8 = 0
Fork Or(cond1, cond2) TrueBlock: {
    result8 = 99
} FalseBlock: {
    result8 = 0
}
expected = 99
actual = result8
RunTask(TestResult)

// Test 1.9: Fork with Not condition
test_name = "Fork with Not"
negative_flag = False
result9 = 0
Fork Not(negative_flag) TrueBlock: {
    result9 = 55
} FalseBlock: {
    result9 = 0
}
expected = 55
actual = result9
RunTask(TestResult)

// ==============================================
// SECTION 2: BASIC BRANCH TESTS
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("SECTION 2: BASIC BRANCH TESTS")
PrintMessage("==============================================")

// Test 2.1: Branch case 1
test_name = "Branch case 1"
selector = 1
result10 = 0
Branch selector {
    Case 1: {
        result10 = 111
    }
    Case 2: {
        result10 = 222
    }
    Default: {
        result10 = 999
    }
}
expected = 111
actual = result10
RunTask(TestResult)

// Test 2.2: Branch case 2
test_name = "Branch case 2"
selector2 = 2
result11 = 0
Branch selector2 {
    Case 1: {
        result11 = 111
    }
    Case 2: {
        result11 = 222
    }
    Default: {
        result11 = 999
    }
}
expected = 222
actual = result11
RunTask(TestResult)

// Test 2.3: Branch default case
test_name = "Branch default"
selector3 = 99
result12 = 0
Branch selector3 {
    Case 1: {
        result12 = 111
    }
    Case 2: {
        result12 = 222
    }
    Default: {
        result12 = 333
    }
}
expected = 333
actual = result12
RunTask(TestResult)

// Test 2.4: Branch with zero
test_name = "Branch case 0"
selector4 = 0
result13 = 0
Branch selector4 {
    Case 0: {
        result13 = 777
    }
    Case 1: {
        result13 = 111
    }
    Default: {
        result13 = 999
    }
}
expected = 777
actual = result13
RunTask(TestResult)

// Test 2.5: Branch with negative number
test_name = "Branch negative"
selector5 = -5
result14 = 0
Branch selector5 {
    Case -5: {
        result14 = 555
    }
    Case 0: {
        result14 = 0
    }
    Default: {
        result14 = 999
    }
}
expected = 555
actual = result14
RunTask(TestResult)

// Test 2.6: Branch with expression
test_name = "Branch expression"
base = 5
result15 = 0
Branch Add(base, 3) {
    Case 5: {
        result15 = 50
    }
    Case 8: {
        result15 = 80
    }
    Default: {
        result15 = 999
    }
}
expected = 80
actual = result15
RunTask(TestResult)

// Test 2.7: Branch with many cases
test_name = "Branch many cases"
choice = 7
result16 = 0
Branch choice {
    Case 1: { result16 = 10 }
    Case 2: { result16 = 20 }
    Case 3: { result16 = 30 }
    Case 4: { result16 = 40 }
    Case 5: { result16 = 50 }
    Case 6: { result16 = 60 }
    Case 7: { result16 = 70 }
    Case 8: { result16 = 80 }
    Default: { result16 = 999 }
}
expected = 70
actual = result16
RunTask(TestResult)

// ==============================================
// SECTION 3: NESTED FORK TESTS
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("SECTION 3: NESTED FORK TESTS")
PrintMessage("==============================================")

// Test 3.1: Fork inside Fork (2 levels)
test_name = "Nested Fork 2 levels"
outer_cond = True
inner_cond = True
result17 = 0
Fork outer_cond TrueBlock: {
    Fork inner_cond TrueBlock: {
        result17 = 123
    } FalseBlock: {
        result17 = 456
    }
} FalseBlock: {
    result17 = 789
}
expected = 123
actual = result17
RunTask(TestResult)

// Test 3.2: Fork inside Fork (false outer)
test_name = "Nested Fork outer false"
outer2 = False
inner2 = True
result18 = 0
Fork outer2 TrueBlock: {
    Fork inner2 TrueBlock: {
        result18 = 111
    } FalseBlock: {
        result18 = 222
    }
} FalseBlock: {
    result18 = 333
}
expected = 333
actual = result18
RunTask(TestResult)

// Test 3.3: Fork inside Fork (false inner)
test_name = "Nested Fork inner false"
outer3 = True
inner3 = False
result19 = 0
Fork outer3 TrueBlock: {
    Fork inner3 TrueBlock: {
        result19 = 111
    } FalseBlock: {
        result19 = 444
    }
} FalseBlock: {
    result19 = 999
}
expected = 444
actual = result19
RunTask(TestResult)

// Test 3.4: Triple nested Fork
test_name = "Triple nested Fork"
level1 = True
level2 = True
level3 = True
result20 = 0
Fork level1 TrueBlock: {
    Fork level2 TrueBlock: {
        Fork level3 TrueBlock: {
            result20 = 12345
        } FalseBlock: {
            result20 = 1
        }
    } FalseBlock: {
        result20 = 2
    }
} FalseBlock: {
    result20 = 3
}
expected = 12345
actual = result20
RunTask(TestResult)

// ==============================================
// SECTION 4: NESTED BRANCH TESTS
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("SECTION 4: NESTED BRANCH TESTS")
PrintMessage("==============================================")

// Test 4.1: Branch inside Branch
test_name = "Nested Branch"
outer_sel = 2
inner_sel = 3
result21 = 0
Branch outer_sel {
    Case 1: {
        result21 = 100
    }
    Case 2: {
        Branch inner_sel {
            Case 3: {
                result21 = 230
            }
            Case 4: {
                result21 = 240
            }
            Default: {
                result21 = 299
            }
        }
    }
    Default: {
        result21 = 999
    }
}
expected = 230
actual = result21
RunTask(TestResult)

// Test 4.2: Branch inside Branch default path
test_name = "Nested Branch default"
outer_sel2 = 2
inner_sel2 = 99
result22 = 0
Branch outer_sel2 {
    Case 1: {
        result22 = 100
    }
    Case 2: {
        Branch inner_sel2 {
            Case 3: {
                result22 = 230
            }
            Default: {
                result22 = 777
            }
        }
    }
    Default: {
        result22 = 999
    }
}
expected = 777
actual = result22
RunTask(TestResult)

// ==============================================
// SECTION 5: FORK INSIDE BRANCH
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("SECTION 5: FORK INSIDE BRANCH")
PrintMessage("==============================================")

// Test 5.1: Fork inside Branch case
test_name = "Fork in Branch"
branch_sel = 1
fork_cond = True
result23 = 0
Branch branch_sel {
    Case 1: {
        Fork fork_cond TrueBlock: {
            result23 = 888
        } FalseBlock: {
            result23 = 999
        }
    }
    Default: {
        result23 = 111
    }
}
expected = 888
actual = result23
RunTask(TestResult)

// Test 5.2: Fork in Branch default
test_name = "Fork in Branch default"
branch_sel2 = 99
fork_cond2 = False
result24 = 0
Branch branch_sel2 {
    Case 1: {
        result24 = 111
    }
    Default: {
        Fork fork_cond2 TrueBlock: {
            result24 = 222
        } FalseBlock: {
            result24 = 333
        }
    }
}
expected = 333
actual = result24
RunTask(TestResult)

// ==============================================
// SECTION 6: BRANCH INSIDE FORK
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("SECTION 6: BRANCH INSIDE FORK")
PrintMessage("==============================================")

// Test 6.1: Branch in Fork true block
test_name = "Branch in Fork true"
fork_flag = True
branch_val = 2
result25 = 0
Fork fork_flag TrueBlock: {
    Branch branch_val {
        Case 1: {
            result25 = 10
        }
        Case 2: {
            result25 = 20
        }
        Default: {
            result25 = 99
        }
    }
} FalseBlock: {
    result25 = 999
}
expected = 20
actual = result25
RunTask(TestResult)

// Test 6.2: Branch in Fork false block
test_name = "Branch in Fork false"
fork_flag2 = False
branch_val2 = 3
result26 = 0
Fork fork_flag2 TrueBlock: {
    result26 = 111
} FalseBlock: {
    Branch branch_val2 {
        Case 3: {
            result26 = 300
        }
        Default: {
            result26 = 999
        }
    }
}
expected = 300
actual = result26
RunTask(TestResult)

// ==============================================
// SECTION 7: FORK/BRANCH WITH LOOPS
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("SECTION 7: FORK/BRANCH WITH LOOPS")
PrintMessage("==============================================")

// Test 7.1: Fork with loop in true block
test_name = "Fork with loop true"
loop_flag = True
result27 = 0
Fork loop_flag TrueBlock: {
    counter = 0
    WhileLoop LessThan(counter, 5) {
        result27 = Add(result27, 1)
        counter = Add(counter, 1)
    }
} FalseBlock: {
    result27 = 999
}
expected = 5
actual = result27
RunTask(TestResult)

// Test 7.2: Branch with loop in case
test_name = "Branch with loop"
case_val = 1
result28 = 0
Branch case_val {
    Case 1: {
        i = 0
        WhileLoop LessThan(i, 3) {
            result28 = Add(result28, 10)
            i = Add(i, 1)
        }
    }
    Default: {
        result28 = 999
    }
}
expected = 30
actual = result28
RunTask(TestResult)

// Test 7.3: Loop with Fork inside
test_name = "Loop with Fork"
result29 = 0
loop_i = 0
WhileLoop LessThan(loop_i, 4) {
    Fork EqualTo(Modulo(loop_i, 2), 0) TrueBlock: {
        result29 = Add(result29, 2)
    } FalseBlock: {
        result29 = Add(result29, 1)
    }
    loop_i = Add(loop_i, 1)
}
expected = 6  // 2+1+2+1
actual = result29
RunTask(TestResult)

// Test 7.4: Loop with Branch inside
test_name = "Loop with Branch"
result30 = 0
j = 0
WhileLoop LessThan(j, 3) {
    Branch j {
        Case 0: { result30 = Add(result30, 100) }
        Case 1: { result30 = Add(result30, 10) }
        Case 2: { result30 = Add(result30, 1) }
        Default: { result30 = Add(result30, 999) }
    }
    j = Add(j, 1)
}
expected = 111  // 100+10+1
actual = result30
RunTask(TestResult)

// ==============================================
// SECTION 8: EDGE CASES
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("SECTION 8: EDGE CASES")
PrintMessage("==============================================")

// Test 8.1: Empty Fork blocks
test_name = "Empty Fork blocks"
result31 = 42
Fork True TrueBlock: {
    // Empty
} FalseBlock: {
    result31 = 999
}
expected = 42
actual = result31
RunTask(TestResult)

// Test 8.2: Empty Branch case
test_name = "Empty Branch case"
result32 = 77
Branch 1 {
    Case 1: {
        // Empty
    }
    Default: {
        result32 = 999
    }
}
expected = 77
actual = result32
RunTask(TestResult)

// Test 8.3: Branch with only default
test_name = "Branch only default"
result33 = 0
Branch 123 {
    Default: {
        result33 = 888
    }
}
expected = 888
actual = result33
RunTask(TestResult)

// Test 8.4: Fork with variable modified in both blocks
test_name = "Fork modify both"
shared = 0
Fork True TrueBlock: {
    shared = 100
} FalseBlock: {
    shared = 200
}
expected = 100
actual = shared
RunTask(TestResult)

// Test 8.5: Branch with variable modified in all cases
test_name = "Branch modify all"
val = 0
Branch 2 {
    Case 1: { val = 10 }
    Case 2: { val = 20 }
    Case 3: { val = 30 }
    Default: { val = 99 }
}
expected = 20
actual = val
RunTask(TestResult)

// ==============================================
// SECTION 9: COMPLEX NESTING PATTERNS
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("SECTION 9: COMPLEX NESTING PATTERNS")
PrintMessage("==============================================")

// Test 9.1: Fork-Branch-Fork sandwich
test_name = "Fork-Branch-Fork"
result34 = 0
Fork True TrueBlock: {
    Branch 2 {
        Case 1: {
            result34 = 111
        }
        Case 2: {
            Fork True TrueBlock: {
                result34 = 222
            } FalseBlock: {
                result34 = 333
            }
        }
        Default: {
            result34 = 999
        }
    }
} FalseBlock: {
    result34 = 888
}
expected = 222
actual = result34
RunTask(TestResult)

// Test 9.2: Branch-Fork-Branch sandwich
test_name = "Branch-Fork-Branch"
result35 = 0
Branch 1 {
    Case 1: {
        Fork True TrueBlock: {
            Branch 3 {
                Case 3: {
                    result35 = 1313
                }
                Default: {
                    result35 = 999
                }
            }
        } FalseBlock: {
            result35 = 888
        }
    }
    Default: {
        result35 = 777
    }
}
expected = 1313
actual = result35
RunTask(TestResult)

// Test 9.3: Five-level nesting
test_name = "5-level nesting"
result36 = 0
Fork True TrueBlock: {
    Branch 1 {
        Case 1: {
            Fork True TrueBlock: {
                Branch 2 {
                    Case 2: {
                        Fork True TrueBlock: {
                            result36 = 55555
                        } FalseBlock: {
                            result36 = 1
                        }
                    }
                    Default: {
                        result36 = 2
                    }
                }
            } FalseBlock: {
                result36 = 3
            }
        }
        Default: {
            result36 = 4
        }
    }
} FalseBlock: {
    result36 = 5
}
expected = 55555
actual = result36
RunTask(TestResult)

// ==============================================
// FINAL SUMMARY
// ==============================================
PrintMessage("")
PrintMessage("==============================================")
PrintMessage("FINAL TEST SUMMARY")
PrintMessage("==============================================")

PrintMessage("Total Tests: ")
PrintNumber(total_tests)
PrintMessage("Passed: ")
PrintNumber(passed_tests)
PrintMessage("Failed: ")
PrintNumber(failed_tests)

success_rate = 0
IfCondition GreaterThan(total_tests, 0) ThenBlock: {
    success_rate = Divide(Multiply(passed_tests, 100), total_tests)
}

PrintMessage("Success Rate: ")
PrintNumber(success_rate)
PrintMessage("%")
PrintMessage("")

IfCondition EqualTo(failed_tests, 0) ThenBlock: {
    PrintMessage("ALL TESTS PASSED!")
    PrintMessage("Branch/Fork flow control is ROCK SOLID!")
} ElseBlock: {
    PrintMessage("SOME FAILURES DETECTED")
    PrintMessage("Review failed tests above")
}

PrintMessage("")
PrintMessage("Coverage:")
PrintMessage("- Basic Fork (true/false paths)")
PrintMessage("- Basic Branch (cases and default)")
PrintMessage("- Nested Fork patterns")
PrintMessage("- Nested Branch patterns")
PrintMessage("- Fork inside Branch")
PrintMessage("- Branch inside Fork")
PrintMessage("- Loops with Fork/Branch")
PrintMessage("- Edge cases (empty blocks, single case)")
PrintMessage("- Complex multi-level nesting")
PrintMessage("")
PrintMessage("Test complete.")
PrintMessage("==============================================")