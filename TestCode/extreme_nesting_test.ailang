// inception_ultra_deep.ailang
// ULTRA DEEP INCEPTION v5: FIXED - All Functions, proper return handling

PrintMessage("========================================\n")
PrintMessage("ULTRA DEEP INCEPTION NESTING TEST v5\n")
PrintMessage("========================================\n")
PrintMessage("\n")

nest_depth = 0
exec_count = 0
max_depth = 0

// All 30 levels as Functions with proper return values

Function.Level30Func {
    Body: {
        PrintMessage("Level 30: Deepest Level\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        // Stress: small loop
        s = 0
        WhileLoop LessThan(s, 10) {
            dummy = Add(s, 1)
            s = dummy
        }
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(30)
    }
}

Function.Level29Func {
    Body: {
        PrintMessage("Level 29: Calling L30\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level30Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(29)
    }
}

Function.Level28Func {
    Body: {
        PrintMessage("Level 28: Calling L29\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level29Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(28)
    }
}

Function.Level27Func {
    Body: {
        PrintMessage("Level 27: Calling L28\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level28Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(27)
    }
}

Function.Level26Func {
    Body: {
        PrintMessage("Level 26: Calling L27\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level27Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(26)
    }
}

Function.Level25Func {
    Body: {
        PrintMessage("Level 25: Calling L26\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level26Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(25)
    }
}

Function.Level24Func {
    Body: {
        PrintMessage("Level 24: Calling L25\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level25Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(24)
    }
}

Function.Level23Func {
    Body: {
        PrintMessage("Level 23: Calling L24\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level24Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(23)
    }
}

Function.Level22Func {
    Body: {
        PrintMessage("Level 22: Calling L23\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level23Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(22)
    }
}

Function.Level21Func {
    Body: {
        PrintMessage("Level 21: Calling L22\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level22Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(21)
    }
}

Function.Level20Func {
    Body: {
        PrintMessage("Level 20: Calling L21\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level21Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(20)
    }
}

Function.Level19Func {
    Body: {
        PrintMessage("Level 19: Calling L20\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level20Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(19)
    }
}

Function.Level18Func {
    Body: {
        PrintMessage("Level 18: Calling L19\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level19Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(18)
    }
}

Function.Level17Func {
    Body: {
        PrintMessage("Level 17: Calling L18\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level18Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(17)
    }
}

Function.Level16Func {
    Body: {
        PrintMessage("Level 16: Calling L17\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level17Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(16)
    }
}

Function.Level15Func {
    Body: {
        PrintMessage("Level 15: Calling L16\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level16Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(15)
    }
}

Function.Level14Func {
    Body: {
        PrintMessage("Level 14: Calling L15\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level15Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(14)
    }
}

Function.Level13Func {
    Body: {
        PrintMessage("Level 13: Calling L14\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level14Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(13)
    }
}

Function.Level12Func {
    Body: {
        PrintMessage("Level 12: Calling L13\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level13Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(12)
    }
}

Function.Level11Func {
    Body: {
        PrintMessage("Level 11: Calling L12\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level12Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(11)
    }
}

Function.Level10Func {
    Body: {
        PrintMessage("Level 10: Calling L11\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level11Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(10)
    }
}

Function.Level9Func {
    Body: {
        PrintMessage("Level 9: Calling L10\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level10Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(9)
    }
}

Function.Level8Func {
    Body: {
        PrintMessage("Level 8: Calling L9\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level9Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(8)
    }
}

Function.Level7Func {
    Body: {
        PrintMessage("Level 7: Calling L8\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level8Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(7)
    }
}

Function.Level6Func {
    Body: {
        PrintMessage("Level 6: Calling L7\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level7Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(6)
    }
}

Function.Level5Func {
    Body: {
        PrintMessage("Level 5: Calling L6\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level6Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(5)
    }
}

Function.Level4Func {
    Body: {
        PrintMessage("Level 4: Calling L5\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level5Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(4)
    }
}

Function.Level3Func {
    Body: {
        PrintMessage("Level 3: Calling L4\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level4Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(3)
    }
}

Function.Level2Func {
    Body: {
        PrintMessage("Level 2: Calling L3\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level3Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(2)
    }
}

Function.Level1Func {
    Body: {
        PrintMessage("Level 1: Calling L2\n")
        exec_count = Add(exec_count, 1)
        nest_depth = Add(nest_depth, 1)
        IfCondition GreaterThan(nest_depth, max_depth) ThenBlock: {
            max_depth = nest_depth
        }
        res = Level2Func()
        nest_depth = Subtract(nest_depth, 1)
        ReturnValue(1)
    }
}

// Main orchestrator
SubRoutine.InceptionMain {
    loop_i = 0
    WhileLoop LessThan(loop_i, 3) {
        PrintMessage("\n=== RUN ")
        PrintNumber(loop_i)
        PrintMessage(" ===\n")
        
        Branch loop_i {
            Case 0: {
                IfCondition True ThenBlock: {
                    Fork True TrueBlock: {
                        result = Level1Func()
                        PrintMessage("Returned from Level1: ")
                        PrintNumber(result)
                        PrintMessage("\n")
                    } FalseBlock: {
                        // Empty
                    }
                } ElseBlock: {
                    // Empty
                }
            }
            Case 1: {
                result = Level1Func()
                PrintMessage("Returned from Level1: ")
                PrintNumber(result)
                PrintMessage("\n")
            }
            Case 2: {
                result = Level1Func()
                PrintMessage("Returned from Level1: ")
                PrintNumber(result)
                PrintMessage("\n")
            }
        }
        loop_i = Add(loop_i, 1)
    }
}

DebugPerf.Start("inception_run")
RunTask(InceptionMain)
DebugPerf.End("inception_run")

PrintMessage("\n========================================\n")
PrintMessage("INCEPTION TEST COMPLETE\n")
PrintMessage("========================================\n")
PrintMessage("Max depth: ")
PrintNumber(max_depth)
PrintMessage("\nExec count: ")
PrintNumber(exec_count)
PrintMessage("\n\nThis demonstrates:\n")
PrintMessage("  • 30-level deep function calls\n")
PrintMessage("  • Branch inside IfCondition inside Fork inside WhileLoop\n")
PrintMessage("  • Proper return value propagation\n")
PrintMessage("  • Zero crashes or corruption\n")
PrintMessage("  • Native x86-64 machine code\n")
PrintMessage("\n✅ Ultra deep inception complete!\n")