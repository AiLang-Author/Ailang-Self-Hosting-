// test_linkage_phase2.ailang
// Test Phase 2: Field Access

LinkagePool.TestPool {
    "field1": Initialize=0
    "field2": Initialize=0
    "field3": Initialize=0
}

PrintMessage("=== Phase 2: Field Access Test ===\n\n")

// Allocate a LinkagePool
PrintMessage("Allocating TestPool...\n")
ptr = AllocateLinkage(LinkagePool.TestPool)
PrintMessage("Allocated at: ")
PrintNumber(ptr)
PrintMessage("\n\n")

// Test field writes using raw memory first
PrintMessage("Writing to fields (raw memory)...\n")
StoreValue(ptr, 100)           // field1 at offset 0
StoreValue(Add(ptr, 8), 200)   // field2 at offset 8
StoreValue(Add(ptr, 16), 300)  // field3 at offset 16

// Verify with raw reads
PrintMessage("Verifying (raw memory):\n")
PrintMessage("  field1: ")
PrintNumber(Dereference(ptr))
PrintMessage("\n  field2: ")
PrintNumber(Dereference(Add(ptr, 8)))
PrintMessage("\n  field3: ")
PrintNumber(Dereference(Add(ptr, 16)))
PrintMessage("\n")

// NOW TEST FIELD ACCESS SYNTAX
PrintMessage("\nTesting field READ access:\n")
PrintMessage("  ptr.field1 = ")
PrintNumber(ptr.field1)  // This should read 100
PrintMessage("\n  ptr.field2 = ")
PrintNumber(ptr.field2)  // This should read 200
PrintMessage("\n  ptr.field3 = ")
PrintNumber(ptr.field3)  // This should read 300

PrintMessage("\n\n=== Phase 2 Test Complete ===\n")