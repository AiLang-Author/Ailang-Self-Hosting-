// test_linkage_phase3.ailang
// Test Phase 3: Field Assignment (Writes)

LinkagePool.TestPool {
    "field1": Initialize=0
    "field2": Initialize=0
    "field3": Initialize=0
}

PrintMessage("=== Phase 3: Field Assignment Test ===\n\n")

// Allocate a LinkagePool
ptr = AllocateLinkage(LinkagePool.TestPool)
PrintMessage("Allocated at: ")
PrintNumber(ptr)
PrintMessage("\n\n")

// TEST FIELD WRITE SYNTAX
PrintMessage("Writing using field assignment syntax:\n")
ptr.field1 = 111
ptr.field2 = 222
ptr.field3 = 333

PrintMessage("Done writing\n\n")

// Verify with field reads
PrintMessage("Reading back using field syntax:\n")
PrintMessage("  ptr.field1 = ")
PrintNumber(ptr.field1)
PrintMessage("\n  ptr.field2 = ")
PrintNumber(ptr.field2)
PrintMessage("\n  ptr.field3 = ")
PrintNumber(ptr.field3)
PrintMessage("\n\n")

// Double-check with raw memory reads
PrintMessage("Verifying with raw memory reads:\n")
PrintMessage("  [ptr+0] = ")
PrintNumber(Dereference(ptr))
PrintMessage("\n  [ptr+8] = ")
PrintNumber(Dereference(Add(ptr, 8)))
PrintMessage("\n  [ptr+16] = ")
PrintNumber(Dereference(Add(ptr, 16)))

PrintMessage("\n\n=== Phase 3 Test Complete ===\n")