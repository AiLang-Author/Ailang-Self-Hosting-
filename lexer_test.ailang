// lexer_standalone_test.ailang
// Direct lexer test - bypasses console, tests lexer directly
// Compile: python3 main.py lexer_standalone_test.ailang
// Run: ./lexer_standalone_test_exec

LibraryImport.XArrays
LibraryImport.Compiler.Frontend.Lexer.CLexerTypes
LibraryImport.Compiler.Frontend.Lexer.CLexerCore
LibraryImport.Compiler.Frontend.Lexer.CLexerKeywords
LibraryImport.Compiler.Frontend.Lexer.CLexerStrings
LibraryImport.Compiler.Frontend.Lexer.CLexerNumbers
LibraryImport.Compiler.Frontend.Lexer.CLexerOperators
LibraryImport.Compiler.Frontend.Lexer.CLexerIdentifiers
LibraryImport.Compiler.Frontend.Lexer.CLexerMain

// =============================================================================
// HELPER: Run lexer on a string and dump tokens
// =============================================================================
Function.LexTest {
    Input: label: Address
    Input: source: Address
    Body: {
        PrintMessage(label)
        PrintMessage("\n")
        PrintMessage("Source: ")
        PrintMessage(source)
        PrintMessage("\n")
        
        len = StringLength(source)
        Lex_Init(source, len)
        Lex_Tokenize()
        Lex_DumpTokens()
        Lex_Free()
        
        PrintMessage("\n")
        ReturnValue(0)
    }
}

// =============================================================================
// MAIN ENTRY POINT
// =============================================================================
SubRoutine.Main {
    PrintMessage("==================================================\n")
    PrintMessage("   AILang Self-Hosting Lexer Test Suite\n")
    PrintMessage("   Direct lexer testing without console\n")
    PrintMessage("==================================================\n\n")
    
    // Test 1: Simple assignment
    LexTest("=== Test 1: Simple Assignment ===", "x = 42")
    
    // Test 2: Decimal number
    LexTest("=== Test 2: Decimal Number ===", "dec = 12345")
    
    // Test 3: Hex number
    LexTest("=== Test 3: Hex Number ===", "hex = 0xFF")
    
    // Test 4: Binary number
    LexTest("=== Test 4: Binary Number ===", "bin = 0b1010")
    
    // Test 5: Two-char operator ==
    LexTest("=== Test 5: EqualTo (==) ===", "a == b")
    
    // Test 6: Two-char operator !=
    LexTest("=== Test 6: NotEqual (!=) ===", "a != b")
    
    // Test 7: Two-char operator >=
    LexTest("=== Test 7: GreaterEqual (>=) ===", "a >= b")
    
    // Test 8: Two-char operator <=
    LexTest("=== Test 8: LessEqual (<=) ===", "a <= b")
    
    // Test 9: Arrow operator
    LexTest("=== Test 9: Arrow (->) ===", "a -> b")
    
    // Test 10: Keywords
    LexTest("=== Test 10: Keywords ===", "IfCondition Add Subtract")
    
    // Test 11: Dotted identifier
    LexTest("=== Test 11: Dotted Identifier ===", "Pool.field")
    
    // Test 12: Delimiters
    LexTest("=== Test 12: Delimiters ===", "{ } ( ) [ ]")
    
    // Test 13: Function call syntax
    LexTest("=== Test 13: Function Call ===", "Add(10, 20)")
    
    // Test 14: Assignment with function
    LexTest("=== Test 14: Assignment + Call ===", "result = Add(1, 2)")
    
    // Test 15: String literal
    src15 = Allocate(16)
    SetByte(src15, 0, 115)  // s
    SetByte(src15, 1, 32)   // space
    SetByte(src15, 2, 61)   // =
    SetByte(src15, 3, 32)   // space
    SetByte(src15, 4, 34)   // "
    SetByte(src15, 5, 72)   // H
    SetByte(src15, 6, 105)  // i
    SetByte(src15, 7, 34)   // "
    SetByte(src15, 8, 0)    // null
    LexTest("=== Test 15: String Literal ===", src15)
    Deallocate(src15, 16)
    
    // Test 16: Comment
    src16 = Allocate(32)
    SetByte(src16, 0, 120)  // x
    SetByte(src16, 1, 32)   // space
    SetByte(src16, 2, 47)   // /
    SetByte(src16, 3, 47)   // /
    SetByte(src16, 4, 32)   // space
    SetByte(src16, 5, 116)  // t
    SetByte(src16, 6, 101)  // e
    SetByte(src16, 7, 115)  // s
    SetByte(src16, 8, 116)  // t
    SetByte(src16, 9, 0)    // null
    LexTest("=== Test 16: Comment ===", src16)
    Deallocate(src16, 32)
    
    // Test 17: Negative number
    LexTest("=== Test 17: Negative Number ===", "n = -42")
    
    // Test 18: Multiple statements
    src18 = Allocate(32)
    SetByte(src18, 0, 97)   // a
    SetByte(src18, 1, 61)   // =
    SetByte(src18, 2, 49)   // 1
    SetByte(src18, 3, 10)   // newline
    SetByte(src18, 4, 98)   // b
    SetByte(src18, 5, 61)   // =
    SetByte(src18, 6, 50)   // 2
    SetByte(src18, 7, 0)    // null
    LexTest("=== Test 18: Multiple Lines ===", src18)
    Deallocate(src18, 32)
    
    PrintMessage("==================================================\n")
    PrintMessage("   ALL TESTS COMPLETE\n")
    PrintMessage("==================================================\n")
}

RunTask(Main)